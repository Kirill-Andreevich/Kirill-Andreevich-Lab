# ðŸŒŒ Homelab IaC: Zen 5 High-Performance Cluster

Ð­Ñ‚Ð¾ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Â«Ð¸Ð½Ð¶ÐµÐ½ÐµÑ€Ð½Ñ‹Ð¹ Ð¿Ð¾Ð»Ð¸Ð³Ð¾Ð½Â» Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð³ÐµÑ‚ÐµÑ€Ð¾Ð³ÐµÐ½Ð½Ð¾Ð¹ ÑÑ€ÐµÐ´Ð¾Ð¹. Ð˜Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚Ð° Ð½Ð° Ð±Ð°Ð·Ðµ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹ **AMD Zen 5** Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· ÑÑ‚ÐµÐº **Terraform + Ansible**.

---

## ðŸ—ï¸ Hardware Stack (Physical Layer)
ÐšÐ»Ð°ÑÑ‚ÐµÑ€ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð´Ð»Ñ Ñ‚ÑÐ¶ÐµÐ»Ñ‹Ñ… Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ð¹ Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¶ÐµÐ»ÐµÐ·Ð° Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸:

| Node | OS | CPU | GPU | Role |
| :--- | :--- | :--- | :--- | :--- |
| **Compute-Node** | EndeavourOS | **Ryzen 9 9950X3D** | **RTX 4090** | AI / Heavy Computing |
| **Workstation** | Manjaro | **Ryzen 7 9800X3D** | **RX 9070 XT** | Dev / Workstation |
| **Storage-Node** | TrueNAS SCALE | **Ryzen 7 9700X** | â€” | ZFS NAS / Core Services |

---

## ðŸ› ï¸ Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° (IaC)

Ð’ Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¾Ð¹:

### 1. Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ (Terraform + Libvirt)
*   **Massive Provisioning**: ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ **10 Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¼Ð°ÑˆÐ¸Ð½** (Ubuntu 24.04) Ð½Ð° Ð³Ð¸Ð¿ÐµÑ€Ð²Ð¸Ð·Ð¾Ñ€Ðµ KVM.
*   **Storage Optimization**: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Copy-on-Write (QCOW2) Ñ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼, Ñ‡Ñ‚Ð¾ ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‚ ~180Ð“Ð‘ Ð´Ð¸ÑÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð°.
*   **Cloud-Init Integration**: ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¾Ð±Ñ€Ð¾Ñ SSH-ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð¸ Ð¿Ñ€ÐµÐ´ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° `qemu-guest-agent`.

### 2. ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ (Ansible)
*   **Dynamic Inventory**: Terraform Ð½Ð° Ð»ÐµÑ‚Ñƒ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ `hosts.ini`, ÑÐ²ÑÐ·Ñ‹Ð²Ð°Ñ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑƒÐ·Ð»Ñ‹ Ð¸ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð’Ðœ.
*   **Universal Deployment**: ÐŸÐ»ÐµÐ¹Ð±ÑƒÐºÐ¸ Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¿Ð¾Ð´ **Arch Linux (Pacman)** Ð¸ **Debian/Ubuntu (Apt)**.
*   **Docker Automation**: Ð Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Docker Runtime Ð½Ð° Ð²ÑÐµÐ¼ ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ðµ.

### 3. Observability (GPU & System Monitoring)
Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¸Ð¹ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ "Ð¶ÐµÐ»ÐµÐ·Ð°":
*   **NVIDIA Stack**: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº `nvidia_gpu_exporter` Ð½Ð° Compute-Node.
*   **AMD Stack**: ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ ÑÐ±Ð¾Ñ€ÐºÐ° `amd-smi-exporter` Ð¸Ð· **AUR** Ð½Ð° Manjaro.
*   **Service Discovery**: Terraform Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ `targets.json` Ð´Ð»Ñ Prometheus, Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ Ð½Ð¾Ð²Ñ‹Ðµ Ð’Ðœ Ð² Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³.

---

## ðŸš€ ÐšÐ°Ðº ÑÑ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

### Ð¨Ð°Ð³ 1: Ð Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
```bash
cd terraform && terraform apply -auto-approve
```
*Terraform ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ 10 Ð½Ð¾Ð´ Ð¸ Ð¿Ñ€Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ Ð¸Ñ… IP Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ Ansible Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð¸ Prometheus.*

### Ð¨Ð°Ð³ 2: ÐŸÐ¾Ð»Ð½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐ¾Ñ„Ñ‚Ð°
```bash
cd ../ansible && ansible-playbook -i inventory/hosts.ini playbooks/site.yml
```
*Ansible Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÑ‚ Docker, ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ GPU ÑÐºÑÐ¿Ð¾Ñ€Ñ‚ÐµÑ€Ñ‹ Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Node Exporter Ð½Ð° Ð²ÑÐµÑ… ÑƒÐ·Ð»Ð°Ñ….*

---

## ðŸ“Š Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
*   **ÐŸÐ¾Ð»Ð½Ð°Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ**: Ð’Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ 10 Ð½Ð¾Ð´ Ñ Ð½ÑƒÐ»Ñ Ð´Ð¾ Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ³Ð¾ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° â€” Ð¼ÐµÐ½ÐµÐµ 3 Ð¼Ð¸Ð½ÑƒÑ‚.
*   **Ð“ÐµÑ‚ÐµÑ€Ð¾Ð³ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ**: Ð•Ð´Ð¸Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¸ Ð´ÐµÑÐºÑ‚Ð¾Ð¿Ð½Ñ‹Ð¼ Manjaro, Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð½Ñ‹Ð¼ Ubuntu, Ð¸ TrueNAS.
*   **GPU Insights**: ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹, Ñ‡Ð°ÑÑ‚Ð¾Ñ‚ Ð¸ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ RTX 4090 Ð¸ RX 9070 XT Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.

---
**Status:** âœ… *Infrastructure is Up and Running. Managed by Code.*

---

## ðŸ—ºï¸ Roadmap: Phase 2 (Enterprise-Grade Scaling)
Ð”Ð°Ð»ÑŒÐ½ÐµÐ¹ÑˆÐµÐµ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹ Ð² ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñƒ Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚Ð¸ Ð¸ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð²Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸:

- [ ] **Grafana as Code**: Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð¾Ð² Ð´Ð»Ñ NVIDIA/AMD SMI Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ (JSON-provisioning).
- [ ] **High Availability**: ÐŸÐµÑ€ÐµÐµÐ·Ð´ Ñ Ð¾Ð´Ð¸Ð½Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Prometheus Ð½Ð° **Thanos** Ð¸Ð»Ð¸ **VictoriaMetrics** Ð´Ð»Ñ Ð´Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¼ÐµÑ‚Ñ€Ð¸Ðº.
- [ ] **Log Management**: Ð’Ð½ÐµÐ´Ñ€ÐµÐ½Ð¸Ðµ ÑÑ‚ÐµÐºÐ° **Loki + Promtail** Ð´Ð»Ñ ÐºÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ð¸ Ð»Ð¾Ð³Ð¾Ð² Ñ GPU-Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ°Ð¼Ð¸ (Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¿Ð°Ð´ÐµÐ½Ð¸Ð¹ Ð´Ñ€Ð°Ð¹Ð²ÐµÑ€Ð¾Ð²).
- [ ] **Network Isolation**: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ€Ð°Ð·Ð´ÐµÐ»ÑŒÐ½Ñ‹Ñ… VLAN Ð´Ð»Ñ Ñ‚Ñ€Ð°Ñ„Ð¸ÐºÐ° Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· Terraform (Libvirt Network isolation).
- [ ] **Alerting**: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° **Alertmanager** Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð² Telegram Ð¿Ñ€Ð¸ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¼ Ð¿ÐµÑ€ÐµÐ³Ñ€ÐµÐ²Ðµ GPU (>85Â°C) Ð¸Ð»Ð¸ Ð´ÐµÐ³Ñ€Ð°Ð´Ð°Ñ†Ð¸Ð¸ ZFS-Ð¿ÑƒÐ»Ð°.

---
**Status:** ðŸ““ *Phase 1 Complete. Scaling in Progress...*
