# üõ† Kirill-Andreevich-Lab: Control Center

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–æ–µ–π –¥–æ–º–∞—à–Ω–µ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏. –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥—Ö–æ–¥ **Infrastructure-as-Code (IaC)** –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes –ø–æ–≤–µ—Ä—Ö KVM/Libvirt —Å –≤–Ω–µ—à–Ω–∏–º iSCSI-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –Ω–∞ –±–∞–∑–µ TrueNAS.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
* **Compute Node (192.168.1.22):** AMD Ryzen 9950X ‚Äî —Ö–æ—Å—Ç–∏–Ω–≥ worker-–Ω–æ–¥ Kubernetes.
* **Workstation (192.168.1.23):** AMD Ryzen 9800X ‚Äî —Ö–æ—Å—Ç–∏–Ω–≥ master-–Ω–æ–¥—ã –∏ GitLab.
* **Storage (192.168.1.30):** TrueNAS Core ‚Äî ZFS-–ø—É–ª—ã, —Ä–∞–∑–¥–∞—á–∞ iSCSI (Democratic CSI).
* **Gateway (192.168.1.1):** OpenWrt ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, DHCP, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–≤—è–∑–∫–∏ MAC-IP.

## üåê –°–µ—Ç–µ–≤–æ–π –ø–ª–∞–Ω (IPAM)
| –ì—Ä—É–ø–ø–∞ | IP / –î–∏–∞–ø–∞–∑–æ–Ω | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| :--- | :--- | :--- |
| **Infra** | `192.168.1.1` | OpenWrt Router |
| **Servers**| `192.168.1.22-23` | –ì–∏–ø–µ—Ä–≤–∏–∑–æ—Ä—ã (9950X, 9800X) |
| **Storage**| `192.168.1.30` | TrueNAS Core |
| **K8s Nodes** | `192.168.1.100` | Master Node |
| **K8s Nodes** | `192.168.1.111+` | Worker Nodes |
| **MetalLB**| `192.168.1.200-239`| –ü—É–ª –¥–ª—è LoadBalancer —Å–µ—Ä–≤–∏—Å–æ–≤ K8s |
| **DHCP** | `192.168.1.240-254`| –î–∏–Ω–∞–º–∏–∫–∞ –¥–ª—è –≥–æ—Å—Ç–µ–≤—ã—Ö/–Ω–æ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Makefile)
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ª–∞–±—ã –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `make`:
* `make tf-apply` ‚Äî –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã (Terraform).
* `make all` ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –û–°, K8s, Flannel –∏ —Å–æ–±—Ä–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä (Ansible).
* `make k8s-config` ‚Äî –°–∫–∞—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ `kubectl` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É.
* `make apps` ‚Äî –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã MetalLB –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
* `make tf-destroy` ‚Äî –£–Ω–∏—á—Ç–æ–∂–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∫–∏.

## üìö –®–ø–∞—Ä–≥–∞–ª–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
**Kubernetes:**
* `kubectl get nodes -o wide` ‚Äî –°—Ç–∞—Ç—É—Å –∏ IP-–∞–¥—Ä–µ—Å–∞ —É–∑–ª–æ–≤.
* `kubectl get svc -A` ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–¥–∞–Ω–Ω—ã–µ MetalLB –≤–Ω–µ—à–Ω–∏–µ IP-–∞–¥—Ä–µ—Å–∞.
* `kubectl get pods -A -w` ‚Äî –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –ø–æ–¥–Ω—è—Ç–∏–µ–º –ø–æ–¥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**Storage / iSCSI:**
* `iscsiadm -m discovery -t sendtargets -p 192.168.1.30` ‚Äî –ü–æ–∏—Å–∫ —Ç–∞—Ä–≥–µ—Ç–æ–≤.

**–ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
* `./generate_blob.sh` ‚Äî –°–æ–±—Ä–∞—Ç—å —á–∏—Å—Ç—ã–π –∫–æ–Ω—Ñ–∏–≥ (–±–µ–∑ venv –∏ archive) –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä .22.
