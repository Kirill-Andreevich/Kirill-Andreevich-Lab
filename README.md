# üååHomelab IaC: Zen 5 Cluster Management

–≠—Ç–æ –º–æ–π –ª–∏—á–Ω—ã–π ¬´–∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –ø–æ–ª–∏–≥–æ–Ω¬ª –∏ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π. –ó–¥–µ—Å—å —è —Ñ–∏–∫—Å–∏—Ä—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É—é —Ä—É—Ç–∏–Ω—É –∏ —Ç–µ—Å—Ç–∏—Ä—É—é –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏. –í—Å–µ, —á—Ç–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –≤ –º–æ–µ–π —Å–µ—Ç–∏, –æ–ø–∏—Å–∞–Ω–æ –≤ –∫–æ–¥–µ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Ansible**.

---

## üõ†Ô∏è Hardware Stack (Bare-metal Cluster)
–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –±–∞–∑–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã **AMD Zen 5** –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –≤ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö:

| Node | OS | CPU | GPU | Role |
| :--- | :--- | :--- | :--- | :--- |
| **Compute-Node** | EndeavourOS | **Ryzen 9 9950X3D** | **RTX 4090** | AI / Heavy Computing |
| **Storage-Node** | TrueNAS SCALE | **Ryzen 7 9700X** | ‚Äî | ZFS NAS / Core Services |
| **Workstation** | Manjaro | **Ryzen 7 9800X3D** | **RX 9070 XT** | Dev / Workstation |

---

## üöÄ Infrastructure as Code (Automation)
–Ø –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é —Å–µ—Ä–≤–∏—Å—ã –≤—Ä—É—á–Ω—É—é ‚Äî –≤—Å—ë —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è **Ansible-–ø–ª–µ–π–±—É–∫–∞–º–∏** –∏–∑ —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

**–ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:**
*   **Docker Runtime**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –¥–µ–ø–ª–æ–π Docker-–¥–≤–∏–∂–∫–∞ –Ω–∞ –≤—Å–µ —É–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞.
*   **Observability Stack**: –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è **Prometheus** –∏ **Grafana**. 
*   **Exporters**: –ú–∞—Å—Å–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤:
    *   `node_exporter` –¥–ª—è —Å–±–æ—Ä–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ (CPU, RAM, ZFS).
    *   `nvidia-device-exporter` –∏ `amdgpu_exporter` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è GPU.
*   **Security**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞–º–∏, SSH-–∫–ª—é—á–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall.

---

## üìä Observability & Monitoring
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å–æ –≤—Å–µ–π –≥–µ—Ç–µ—Ä–æ–≥–µ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã. –Ø –∏—Å–ø–æ–ª—å–∑—É—é —ç—Ç–æ—Ç —Å—Ç–µ–Ω–¥ –¥–ª—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ¬´–∂–µ–ª–µ–∑–∞¬ª –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–æ–≤ –≤ Prometheus:**
![Prometheus Targets](img/prometheus_targets.jpg)

*   –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —É–∑–ª–æ–≤ (Storage, Compute, Workstation).
*   –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è GPU (NVIDIA/AMD) ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ, –Ω–∞–≥—Ä—É–∑–∫–∞.
*   –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—É–ª–æ–≤ **ZFS** –Ω–∞ TrueNAS SCALE.

---

## üì¶ Application Stack (TrueNAS Apps)
–°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ –±–∞–∑–µ TrueNAS SCALE, –∫–æ—Ç–æ—Ä—ã–º–∏ —è —É–ø—Ä–∞–≤–ª—è—é –∏ –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ:

![TrueNAS Apps](img/truenas_apps.jpg)

*   **Management**: Nginx Proxy Manager, RustDesk (Remote Access).
*   **Cloud & Media**: Nextcloud, Jellyfin.
*   **Tools**: qBittorrent, Open-speed-test.
*   **Monitoring**: Prometheus, Grafana.

---

## üó∫Ô∏è Roadmap (–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π / –ó–∞–º–µ—Ç–∫–∏)
–ó–∞–¥–∞—á–∏, –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º–∏ —è —Ä–∞–±–æ—Ç–∞—é —Å–µ–π—á–∞—Å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ—Ç–æ—Ä—ã—Ö —Ñ–∏–∫—Å–∏—Ä—É—é –≤ —ç—Ç–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:

- [ ] **Zabbix Refactoring**: –ú–∏–≥—Ä–∞—Ü–∏—è –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ Zabbix –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (Docker).
- [ ] **Log Management**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å—Ç–µ–∫–∞ **Loki** –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤.
- [ ] **Alerting**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ **Alertmanager** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ZFS –≤ Telegram.
- [ ] **IaC Cleanup**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø–ª–µ–π–±—É–∫–æ–≤ –≤ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–æ–ª–∏.

---
**Status:** üìì *–≠—Ç–æ "Knowledge Base". –ó–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –∏–∑—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —à—Ç—É–∫ –∏ —Ä–µ—à–µ–Ω–∏—è –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö –∑–∞–¥–∞—á.*

---

## üèóÔ∏è Phase 2: Massive Scaling (The 30-VM Challenge)
–¶–µ–ª—å: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å 30 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –¥–ª—è —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ KVM –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

- [ ] **Provisioning**: –ù–∞–ø–∏—Å–∞—Ç—å Terraform-–º–æ–¥—É–ª—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `count = 30`.
- [ ] **Orchestration**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Ansible Inventory –∏–∑ Terraform State.
- [ ] **Monitoring**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ 32 –ø–æ—Ç–æ–∫–æ–≤ 9950X3D –ø–æ–¥ –º–∞—Å—Å–æ–≤—ã–º –¥–µ–ø–ª–æ–µ–º.
